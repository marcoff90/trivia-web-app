{"version":3,"file":"DuelMiddleware.js","names":["DuelMiddleware","req","res","next","DuelRepository","findAllUnfinished","duels","findAllUnfinishedWithBothPlayers","duelsWithBothPlayers","console","log","timeNow","Math","round","Date","now","i","length","createdAt","finished","save","playerTwoConnectedAt"],"sources":["../../src/middlewares/DuelMiddleware.js"],"sourcesContent":["import DuelRepository from \"../repositories/duel-repository\";\n\nconst DuelMiddleware = async (req, res, next) => {\n  let duels = await DuelRepository.findAllUnfinished();\n  let duelsWithBothPlayers = await DuelRepository.findAllUnfinishedWithBothPlayers();\n  console.log(duelsWithBothPlayers)\n  let timeNow = Math.round(Date.now() / 1000);\n\n  if (duels) {\n    for (let i = 0; i < duels.length; i++) {\n      if (timeNow > duels[i].createdAt + 180) {\n        duels[i].finished = true;\n        await duels[i].save();\n      }\n    }\n  }\n\n  if (duelsWithBothPlayers) {\n    for (let i = 0; i < duelsWithBothPlayers.length; i++) {\n      if (timeNow > duelsWithBothPlayers[i].playerTwoConnectedAt + 180) {\n        duelsWithBothPlayers[i].finished = true;\n        await duelsWithBothPlayers[i].save();\n      }\n    }\n  }\n  next();\n};\n\nexport default DuelMiddleware;\n"],"mappings":";;;;;;;AAAA;;;;;;;;AAEA,IAAMA,cAAc;EAAA,mEAAG,iBAAOC,GAAP,EAAYC,GAAZ,EAAiBC,IAAjB;IAAA;;IAAA;MAAA;QAAA;UAAA;YAAA;YAAA,OACHC,2BAAeC,iBAAf,EADG;;UAAA;YACjBC,KADiB;YAAA;YAAA,OAEYF,2BAAeG,gCAAf,EAFZ;;UAAA;YAEjBC,oBAFiB;YAGrBC,OAAO,CAACC,GAAR,CAAYF,oBAAZ;YACIG,OAJiB,GAIPC,IAAI,CAACC,KAAL,CAAWC,IAAI,CAACC,GAAL,KAAa,IAAxB,CAJO;;YAAA,KAMjBT,KANiB;cAAA;cAAA;YAAA;;YAOVU,CAPU,GAON,CAPM;;UAAA;YAAA,MAOHA,CAAC,GAAGV,KAAK,CAACW,MAPP;cAAA;cAAA;YAAA;;YAAA,MAQbN,OAAO,GAAGL,KAAK,CAACU,CAAD,CAAL,CAASE,SAAT,GAAqB,GARlB;cAAA;cAAA;YAAA;;YASfZ,KAAK,CAACU,CAAD,CAAL,CAASG,QAAT,GAAoB,IAApB;YATe;YAAA,OAUTb,KAAK,CAACU,CAAD,CAAL,CAASI,IAAT,EAVS;;UAAA;YAOeJ,CAAC,EAPhB;YAAA;YAAA;;UAAA;YAAA,KAejBR,oBAfiB;cAAA;cAAA;YAAA;;YAgBVQ,EAhBU,GAgBN,CAhBM;;UAAA;YAAA,MAgBHA,EAAC,GAAGR,oBAAoB,CAACS,MAhBtB;cAAA;cAAA;YAAA;;YAAA,MAiBbN,OAAO,GAAGH,oBAAoB,CAACQ,EAAD,CAApB,CAAwBK,oBAAxB,GAA+C,GAjB5C;cAAA;cAAA;YAAA;;YAkBfb,oBAAoB,CAACQ,EAAD,CAApB,CAAwBG,QAAxB,GAAmC,IAAnC;YAlBe;YAAA,OAmBTX,oBAAoB,CAACQ,EAAD,CAApB,CAAwBI,IAAxB,EAnBS;;UAAA;YAgB8BJ,EAAC,EAhB/B;YAAA;YAAA;;UAAA;YAuBrBb,IAAI;;UAvBiB;UAAA;YAAA;QAAA;MAAA;IAAA;EAAA,CAAH;;EAAA,gBAAdH,cAAc;IAAA;EAAA;AAAA,GAApB;;eA0BeA,c"}